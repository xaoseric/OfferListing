{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ offer.name }}{% endblock %}

{% block page_title %}
  {{ offer.name }}
  <a href="{{ offer.provider.get_absolute_url }}"><small>{{ offer.provider.name }}</small></a>
{% endblock %}

{% block content %}
  {{ offer.content | safe }}
  <br />
  <p>
    <strong>{{ offer.provider.name }} TOS: </strong><a href="{{ offer.provider.tos }}">{{ offer.provider.tos }}</a>
  </p>
  <hr>
  <h2>Plans on offer:</h2>
  {% include 'offers/plan_set.html' with plan_set=offer.plan_set.all %}
  <h3>Locations:</h3>
  {% for location in offer.get_plan_locations %}
    {% include 'offers/location_detail.html' with location=location %}
  {% endfor %}
  <hr>
  <a name="comments"></a>
  <h2>Comments:</h2>
  {% include 'offers/comments.html' with comments=offer.get_comments %}
  {% if request.user.is_authenticated %}
    <a name="new-comment"></a>
    <h3>Add a comment</h3>
    {% crispy form %}
  {% endif %}
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
  $(document).ready(function(){
    CKEDITOR.replace("comment", {
      toolbar: [
        { name: 'basicstyles', groups: [ 'basicstyles', 'cleanup' ], items: [ 'Bold', 'Italic', 'Strike', '-', 'RemoveFormat' ] },
        { name: 'clipboard', items: [ 'Cut', 'Copy', 'Paste', 'PasteText', 'PasteFromWord', '-', 'Undo', 'Redo' ] },
        { name: 'editing', groups: [ 'find', 'selection', 'spellchecker' ], items: [ 'Scayt' ] },
        { name: 'insert', items: [ 'SpecialChar' ] },
        { name: 'paragraph', groups: [ 'list', 'indent', 'blocks', 'align', 'bidi' ], items: [ 'NumberedList', 'BulletedList', '-', 'Outdent', 'Indent', '-', 'Blockquote' ] },
        { name: 'styles', items: [ 'Format' ] }
      ],
      format_tags: "p;pre"
  });
  });

  function setReply(data){
    $("#id_reply_to").val(data["comment_id"]);
    $("#comment_reply_to").html('<div class="well">' +
            '<h5>Replying to comment by ' + data["commenter"] + ': </h5>' +
            data["content"] +
            '<br><br>' +
            '<a href="#new-comment" class="btn btn-danger" onclick="cancelReply()">Cancel Reply</a>' +
            '</div>');
  }
  function cancelReply(){
    $("#id_reply_to").val(-1);
    $("#comment_reply_to").html("")
  }
</script>
{% endblock %}
